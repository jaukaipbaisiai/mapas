<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GeoJSON Admin Panel with Map</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
    <style>
        #map { height: 80vh; width: 100%; }
        #editor { padding: 10px; display: none; }
        #login { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: white; display: flex; flex-direction: column; align-items: center; justify-content: center; }
    </style>
</head>
<body>
    <div id="login">
        <h2>Enter Password</h2>
        <input type="password" id="password" placeholder="Enter Password">
        <button onclick="checkPassword()">Login</button>
    </div>
    
    <div id="content" style="display: none;">
        <h2>GeoJSON Admin Panel with Interactive Map</h2>
        <div id="map"></div>
        <div id="editor">
            <h3>Edit Lot</h3>
            <p><strong>Lot ID:</strong> <span id="lot-id"></span></p>
            <label>Price: $<input type="text" id="lot-price"></label><br>
            <label>Status:
                <select id="lot-status">
                    <option value="For Sale">For Sale</option>
                    <option value="Sold">Sold</option>
                    <option value="Reserved">Reserved</option>
                </select>
            </label><br>
            <label>Area: <input type="text" id="lot-area"></label><br>
            <label>Category:
                <select id="lot-category">
                    <option value="Single Family Homesites">Single Family Homesites</option>
                    <option value="Multi Family Homesites">Multi Family Homesites</option>
                    <option value="Commercial">Commercial</option>
                    <option value="Mixed Use">Mixed Use</option>
                </select>
            </label><br>
            <label>Parking: <input type="text" id="lot-parking"></label><br>
            <label>Units: <input type="text" id="lot-units"></label><br>
            <label>Sub Category: <input type="text" id="lot-subcategory"></label><br>
            <label>Name: <input type="text" id="lot-name"></label><br>
            <button onclick="saveChanges()">Save Changes</button>
            <button onclick="downloadGeoJSON()">Download JSON File</button>
        </div>
    </div>
    
    <script>
        let geojsonData;
        let selectedFeature;
        let map = L.map('map').setView([11.575, -86.244], 16);
        let baseLayers = {
            'Street View': L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png'),
            'Satellite View': L.tileLayer('https://{s}.tile.opentopomap.org/{z}/{x}/{y}.png')
        };
        baseLayers['Street View'].addTo(map);
        L.control.layers(baseLayers).addTo(map);

        async function loadGeoJSON() {
            const response = await fetch('lots.geojson');
            geojsonData = await response.json();
            L.geoJSON(geojsonData, {
                onEachFeature: function (feature, layer) {
                    layer.on('click', function () {
                        selectedFeature = feature;
                        document.getElementById('editor').style.display = 'block';
                        document.getElementById('lot-id').innerText = feature.properties.plot_id;
                        document.getElementById('lot-price').value = feature.properties.price || '';
                        document.getElementById('lot-status').value = feature.properties.status || 'For Sale';
                        document.getElementById('lot-area').value = feature.properties.area_m || '';
                        document.getElementById('lot-category').value = feature.properties.Category || 'Single Family Homesites';
                        document.getElementById('lot-parking').value = feature.properties.Parking || 'N/A';
                        document.getElementById('lot-units').value = feature.properties.Units || '1';
                        document.getElementById('lot-subcategory').value = feature.properties.Sub_Cat || '';
                        document.getElementById('lot-name').value = feature.properties.Name || '';
                    });
                }
            }).addTo(map);
        }

        function saveChanges() {
            if (!selectedFeature) return;

            selectedFeature.properties.price = document.getElementById('lot-price').value;
            selectedFeature.properties.status = document.getElementById('lot-status').value;
            selectedFeature.properties.area_m = document.getElementById('lot-area').value;
            selectedFeature.properties.Category = document.getElementById('lot-category').value;
            selectedFeature.properties.Parking = document.getElementById('lot-parking').value;
            selectedFeature.properties.Units = document.getElementById('lot-units').value;
            selectedFeature.properties.Sub_Cat = document.getElementById('lot-subcategory').value;
            selectedFeature.properties.Name = document.getElementById('lot-name').value;
        }

        function downloadGeoJSON() {
            const updatedGeoJSON = JSON.stringify(geojsonData, null, 4);
            const blob = new Blob([updatedGeoJSON], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'lots_updated.geojson';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
        }

        function checkPassword() {
            const password = document.getElementById('password').value;
            if (password === 'jaukaipbaisiai') {
                document.getElementById('login').style.display = 'none';
                document.getElementById('content').style.display = 'block';
                loadGeoJSON();
            } else {
                alert('Incorrect password');
            }
        }
    </script>
</body>
</html>
